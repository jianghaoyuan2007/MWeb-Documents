# 处理 IQKeyboardManager 与 UITableVIew 的冲突


在使用 `IQKeyboardManager` 的时候，确实会带来很多方便，因为对 `UIKeyboard` 的处理向来都是稍微有点麻烦的。但如果在使用时候错误地设置了某个属性，那么将会带来一些奇怪的事情发生。

如果你在使用 `UITableView`，并且你的 `UITableViewCell` 中还有一个 `UITextView` 或者 `UITextFiled`，那你可能要小心了。

示例代码如下所示：

```swift
extension ViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        
        IQKeyboardManager.shared.enable = true
        // 设置点击非输入框区域关闭键盘
        IQKeyboardManager.shared.shouldResignOnTouchOutside = true
    }
}
```

[此处附上一个 `GIF` 格式的图片]

当点击非输入框区域时，`IQKeyboardManager` 会关闭键盘，并且修改 `UITableView` 的 `contentInsets` 属性，但对应的 UI 却没有及时被更新，导致点击与响应的 `UITableViewCell` 不一致，或者是点击空白区域，莫名其妙的 `UITableViewCell` 被点击了。

产生这个问题的根源在于一点击 `UITableViewCell` 就立刻关闭了键盘，改变了 `UITableView` 的 `contentInsets` 属性。所以，只要将对应代码修改为`IQKeyboardManager.shared.shouldResignOnTouchOutside = false`。再添加对键盘的关闭进行处理即可。

修复该问题的代码如下：

```swift
extension ViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        
        IQKeyboardManager.shared.enable = true
        IQKeyboardManager.shared.shouldResignOnTouchOutside = false
    }
}

extension ViewController: UITableViewDelegate {
    
    func scrollViewWillBeginDragging(_ scrollView: UIScrollView) {
        self.view.endEditing(true)
    }
}
```

[此处附上一个 `GIF` 格式的图片]


