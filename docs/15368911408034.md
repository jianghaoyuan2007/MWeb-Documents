# 内存管理经验总结

### 内存管理经验总结

* 在 `Class` 中添加析构方法 `deinit` 对是否正常销毁进行检测。

* 避免使用 `Lazy Stored Properties` 的方式去创建 UI 视图。

```swift
// 闭包内捕获了 `self`
private lazy var button: UIButton = {
    let button = UIButton()
    button.setTitle("確定", for: .normal)
    button.addTarget(self, action: #selector(closeButtonTapped), for: .touchUpInside)
    return button
}()
```

```swift
// 闭包内捕获了 `self`
private lazy var tableView: UITableView = {
    let tableView = UITableView.init(frame: self.view.bounds, style: .plain)
    tableView.estimatedRowHeight = 50
    tableView.rowHeight = UITableViewAutomaticDimension
    return tableView
}()
```


```swift
// 这种方式不会造成循环引用
private lazy var rightBarButtonItem = UIBarButtonItem(barButtonSystemItem: .done,
                                                      target: self,
                                                      action: #selector(doneBarButtonTapped))
```

* 避免在 `map` 等函数中直接使用 `self`。

```swift
self.options.asObservable()
    .map { _ in self.toSections() }
    .bind(to: self.sections)
    .disposed(by: disposeBag)
```


```swift
self.searchBar.rx.text.asObservable()
    .map { $0 == nil ? "" : $0! }
    .map(self.filterOptions)
    .bind(to: self.searchOptions)
    .disposed(by: self.disposeBag)
```

